<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Respuesta | Validador & Generador (Transporte Escolar)</title>
  <link rel="stylesheet" href="styles.css"/>

  <!-- XLSX (SheetJS) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>

  <!-- PDF.js (versión 3.x con .js clásico, evita fallo de .mjs) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>

  <!-- JSZip (para validar imágenes/medios dentro de XLSM/XLSX) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>

  <!-- DOCX templating -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pizzip/3.1.6/pizzip.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.46.2/docxtemplater.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
</head>

<body>
  <header class="topbar">
    <div class="brand">
      <div class="logoBox" aria-hidden="true">
        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 2l7 4v6c0 5-3 9-7 10-4-1-7-5-7-10V6l7-4z" stroke="currentColor" stroke-width="1.6"/>
          <path d="M8 11h8M8 14h8" stroke="currentColor" stroke-width="1.6" stroke-linecap="round"/>
        </svg>
      </div>
      <div>
        <h1>Respuesta</h1>
        <div class="subtitle">Validador + Generador automático de respuesta (Word)</div>
      </div>
    </div>
    <div class="badge">Revisión crítica • Checklist + Comparativo</div>
  </header>

  <main class="grid">
    <section class="card">
      <h2>1) Cargar insumos</h2>
      <p class="muted">Arrastra y suelta o selecciona archivos. Se valida en local (no se sube nada).</p>

      <div class="dropgrid">
        <div class="dropbox" data-accept=".pdf" id="dropMemo">
          <div class="dropTitle">Memorando (PDF)</div>
          <div class="dropHint">Arrastra aquí el PDF</div>
          <input type="file" accept=".pdf,application/pdf" id="memoFile" />
          <div class="fileMeta" id="memoMeta">Sin archivo</div>
        </div>

        <div class="dropbox" data-accept=".xlsx,.xls,.xlsm" id="dropModel">
          <div class="dropTitle">Modelamiento (Excel)</div>
          <div class="dropHint">Arrastra aquí el Excel</div>
          <input type="file" accept=".xlsx,.xls,.xlsm" id="modelFile" />
          <div class="fileMeta" id="modelMeta">Sin archivo</div>
        </div>

        <div class="dropbox" data-accept=".xlsx,.xls,.xlsm" id="dropRef">
          <div class="dropTitle">Referencia Beneficiarios (Excel)</div>
          <div class="dropHint">Opcional, pero recomendado (DAEI)</div>
          <input type="file" accept=".xlsx,.xls,.xlsm" id="refFile" />
          <div class="fileMeta" id="refMeta">Sin archivo</div>
        </div>

        <div class="dropbox" data-accept=".xlsx,.xls,.xlsm" id="dropHist">
          <div class="dropTitle">Base histórica (2025) (Excel)</div>
          <div class="dropHint">Opcional: comparar rutas/beneficiarios/costo</div>
          <input type="file" accept=".xlsx,.xls,.xlsm" id="histFile" />
          <div class="fileMeta" id="histMeta">Sin archivo</div>
        </div>

        <div class="dropbox" data-accept=".xlsx,.xls,.xlsm" id="dropCuadros">
          <div class="dropTitle">Cuadros (Quipux) (Excel)</div>
          <div class="dropHint">Opcional: para llenado automático</div>
          <input type="file" accept=".xlsx,.xls,.xlsm" id="cuadrosFile" />
          <div class="fileMeta" id="cuadrosMeta">Sin archivo</div>
        </div>

        <div class="dropbox" data-accept=".docx" id="dropTpl">
          <div class="dropTitle">Plantilla (DOCX)</div>
          <div class="dropHint">Puedes usar la incluida</div>
          <input type="file" accept=".docx" id="tplFile" />
          <div class="fileMeta" id="tplMeta">
            Incluida: <code>templates/plantilla_respuesta.docx</code>
          </div>
        </div>
      </div>

      <div class="actions">
        <button class="btn primary" id="btnValidate">Validar</button>
        <button class="btn" id="btnReset">Limpiar</button>
      </div>

      <div class="divider"></div>

      <h2>2) Datos del memorando</h2>
      <p class="muted">Se intenta extraer del PDF. Si algo no aparece, lo ajustas aquí (y se usa en el Word).</p>

      <div class="form">
        <label>Nro. Memorando
          <input id="fMemoNro" placeholder="Ej: MINEDEC-CZ5-09D14-2026-0096-M"/>
        </label>
        <label>Fecha
          <input id="fMemoFecha" placeholder="Ej: 12 de febrero de 2026"/>
        </label>
        <label>Para
          <input id="fPara" placeholder="Ej: Coordinación Zonal / Dirección Distrital"/>
        </label>
        <label>De
          <input id="fDe" placeholder="Ej: Dirección / Analista responsable"/>
        </label>
        <label>Asunto
          <input id="fAsunto" placeholder="Ej: Validación de modelamiento de rutas"/>
        </label>
        <label>Año lectivo
          <input id="fAnioLectivo" placeholder="Ej: 2026-2027"/>
        </label>
        <label>Firma
          <input id="fFirma" placeholder="Ej: Nombres y Apellidos"/>
        </label>
      </div>

      <div class="note" id="runtimeNote" style="margin-top:12px; display:none;"></div>
    </section>

    <section class="card">
      <div class="row">
        <h2>3) Resultado de validación</h2>
        <div id="statusPill" class="pill neutral">Sin ejecutar</div>
      </div>

      <div class="resultBox" id="resultBox">
        <div class="placeholder">Ejecuta <b>Validar</b> para ver el checklist.</div>
      </div>

      <div class="actions">
        <button class="btn success" id="btnGenerate" disabled>Generar respuesta (Word)</button>
        <button class="btn" id="btnExportCuadros" disabled>Exportar Cuadros (Quipux) llenos</button>
        <a class="link" href="templates/plantilla_respuesta.docx" download>Descargar plantilla incluida</a>
      </div>
      <div id="genMsg" class="genMsg" style="display:none;"></div>

      <div class="note">
        Si algo no funciona, abre la consola del navegador (F12) y busca el bloque “Respuesta | runtime”.
      </div>
    </section>
  </main>

  <footer class="footer">Proyecto: <b>Respuesta</b> • Listo para GitHub Pages.</footer>

  <script src="app.js"></script>
</body>
</html>
